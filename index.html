<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
    <!--Import materialize.css-->
    <link type="text/css" rel="stylesheet" href="css/materialize.css" media="screen,projection" />
    <link type="text/css" rel="stylesheet" href="css/style.css" media="screen,projection" />

    <!--Import jQuery before materialize.js-->
    <script type="text/javascript" src="js/jquery-2.1.1.js"></script>
    <script type="text/javascript" src="js/materialize.js"></script>
    <script type="text/javascript" src="js/angular.js"></script>
    <script>
        (function ($) {
            $(function () {
                $('.button-collapse').sideNav();
            }); // end of document ready
        })(jQuery); // end of jQuery name space

        $('.collapsible').collapsible({
                accordion : true
            // A setting that changes the collapsible behavior to expandable instead of the default accordion style
        });
        function testController($scope,$http){

   /*  $http.jsonp("http://api.pricecheckindia.com/feed/product/mobile_phones/nokia%20107.json?user=vishnude&key=OTNOKPMUNNWIPAVX&callback=JSON_CALLBACK")
    .success(
      function(response) {$scope.jsonData = response.product;}
        );
          */

        $scope.search = function(){
          var str1 = "http://api.pricecheckindia.com/feed/product/mobile_phones/";
          var str2 = ".json?user=vishnude&key=OTNOKPMUNNWIPAVX&callback=JSON_CALLBACK";
          $http.jsonp(str1+encodeURIComponent(document.getElementById('search').value)+str2)
            .success(
              function(response) {
                $scope.jsonData = response.product;
                setTimeout(function(){
                     //enable accordian
                    $('.collapsible').collapsible({
                            accordion : true
                        // A setting that changes the collapsible behavior to expandable instead of the default accordion style
                    });

                }, 1000);

              }
              );
        }

       /**This method process the link from price check and get the actual link to the site
        **/
      $scope.processLinkClick = function(checkUrl){
            // Using YQL and JSONP
        $.ajax({
            url: "http://query.yahooapis.com/v1/public/yql",
            // the name of the callback parameter, as specified by the YQL service
            jsonp: "callback",
            // tell jQuery we're expecting JSONP
            dataType: "jsonp",
            // tell YQL what we want and that we want JSON
            data: {
                q: "select * from html where url=\""+checkUrl+"\""
            },

            // work with the response
            success: function( response ) {
                response = response.results[0];
                var index =  response.indexOf("<a href=\"")
                response = response.substring(index+9);
                response = response.substring(0,response.indexOf("\""));

                window.open(response);
            }
        });

       }



    }

   function search(){
    document.activeElement.blur();
    angular.element(document.getElementById('body')).scope().search();
   }

   $(document).keypress(function(e) {
    if(e.which == 13) {
        search();
    }
   });


    </script>

</head>

<body>

    <nav>
        <div class="nav-wrapper indigo darken-1">
            <div class="container">
                <div class="input-field col s11" style="margin-top: 0rem;">
                    <a href="#" data-activates="slide-out" class="button-collapse">
                        <i class="mdi-navigation-menu" style="font-size: 2rem;"></i>
                    </a>
                    <input id="search" class="right-align" style="padding-right: 2rem;" type="text" required maxlength="50">
                    <label for="search" class="right-align" style="right: 0;" onclick="search();"><i class="mdi-action-search"></i>
                    </label>
                </div>
            </div>
        </div>
    </nav>

    <div id="body" class="container" data-ng-app="" data-ng-controller="testController">

        <!--navigation-->
        <ul id="slide-out" class="side-nav full">
            <li><a href="#">Navbar Link</a>
            </li>
        </ul>


        <!--cards-->
        <div class="card-panel white" data-ng-repeat="product in jsonData">
            <div ng-if="product.stores.length > 0">
                <div class="card-head indigo white-text"><!--Model -->
                    <h5> {{product.model}} </h5>
                </div>
                <div class="row valign-wrapper card-body">
                    <div style="padding-left:1rem;width:50%;text-align: center;">
                        <img src="{{product.stores[0].image}}" alt="" class="responsive-img">
                        <!-- notice the "circle" class -->
                    </div>
                    <div class="col s12" style="text-align: center;">
                        <div class="row"><!--Brand -->
                            <h5>{{product.brand}}</h5>
                            <div class="row valign-wrapper" ng-click="processLinkClick(product.stores[0].url);">
                              <i class="{{product.stores[0].website}}"  style="transform: translateY(0%);">
                              </i>
                            </div>
                            <div class="row">
                              <h6>
                               from &#8377; {{product.stores[0].price}}
                              </h6>
                            </div>
                        </div>
                    </div>

                </div>
                <div>
                <ul class="collapsible" data-collapsible="accordion">
                  <li>
                    <div class="collapsible-header"><i class="mdi-navigation-expand-more Large"></i>More Stores</div>
                    <div class="collapsible-body">
                      <p>Lorem ipsum dolor sit amet.</p>
                    </div>
                  </li>
                </ul>
                </div>
            </div>
        </div>


    </div>

    </body>

</html>
